import yaml
import dotenv
from pathlib import Path

config_dir = Path(__file__).parent.parent.resolve() / "config"

# load yaml config
with open(config_dir / "config.yml", 'r') as f:
    config_yaml = yaml.safe_load(f)

# load .env config
config_env = dotenv.dotenv_values(config_dir / "config.env")

# config parameters
telegram_token = config_yaml["telegram_token"]
openai_api_key = config_yaml["openai_api_key"]
use_chatgpt_api = config_yaml.get("use_chatgpt_api", True)
allowed_telegram_usernames = config_yaml["allowed_telegram_usernames"]
new_dialog_timeout = config_yaml["new_dialog_timeout"]
enable_message_streaming = config_yaml.get("enable_message_streaming", True)
payme_link = config_yaml['payme_link']
mongodb_uri = f"mongodb://mongo:{config_env['MONGODB_PORT']}"
admin_username = "galactusadmin"
n_default_tokens = config_yaml['n_default_tokens']
HELP_MESSAGE = f"""–° –ø–æ–º–æ—â—å—é —ç—Ç–æ–≥–æ –±–æ—Ç–∞ –≤—ã —Å–º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –æ—Ç –ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞.
–Ø –º–æ–≥—É:

üíª –î–∞—Ç—å —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π –æ—Ç–≤–µ—Ç, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –º–æ–∂–µ—Ç –¥–∞—Ç—å –≤–∞–º Google.

üìù –Ø –º–æ–≥—É –Ω–∞–ø–∏—Å–∞—Ç—å –¥–ª—è –≤–∞—Å Essay(—Å–æ—á–∏–Ω–µ–Ω–∏–µ) –Ω–∞ –ª—é–±—É—é —Ç–µ–º—É.

üìö –ù–∞–ø–∏—Å–∞—Ç—å Assignment, –†–µ—Ñ–µ—Ä–∞—Ç, –î–æ–∫–ª–∞–¥–Ω—É—é —Ä–∞–±–æ—Ç—É –Ω–∞ 3000 —Å–ª–æ–≤ –∏ –±–æ–ª—å—à–µ (–±–µ–∑ –ø–ª–∞–≥–∏–∞—Ç–∞).

üßÆ –†–µ—à–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è.

üí∏ –ù–∞–ø–∏—Å–∞—Ç—å –±–∏–∑–Ω–µ—Å –ø–ª–∞–Ω
–ò –ø–æ–º–æ—á—å —Å —Ä–∞–±–æ—Ç–æ–π.

–Ø –ø–æ–Ω–∏–º–∞—é –±–æ–ª–µ–µ 10 —è–∑—ã–∫–æ–≤, —Ç–∞–∫ –∂–µ –≤—ã –º–æ–∂–µ—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –º–Ω–µ –∞—É–¥–∏–æ –≤–º–µ—Å—Ç–æ —Ç–µ–∫—Å—Ç–∞.

PRICE LIST
ü™¨3000 –¢–û–ö–ï–ù–û–í(~700—Å–ª–æ–≤, 3~4 –∑–∞–ø—Ä–æ—Å–∞) 15.000 —Å—É–º
ü™¨6000 –¢–û–ö–ï–ù–û–í(~1400—Å–ª–æ–≤, 6~7 –∑–∞–ø—Ä–æ—Å–æ–≤) 30.000 —Å—É–º
ü™¨10000 –¢–û–ö–ï–ù–û–í(~2400—Å–ª–æ–≤, 10~11 –∑–∞–ø—Ä–æ—Å–æ–≤) 50.000 —Å—É–º
 –ò —Ç–¥.

–ß–µ–º –±–æ–ª—å—à–µ —Ç–æ–∫–µ–Ω–æ–≤ –∑–∞–∫—É–ø–∞–µ—Ç–µ, —Ç–µ–º –±–æ–ª—å—à–µ –±–æ—Ç –≤—ã–¥–∞–µ—Ç –æ—Ç–≤–µ—Ç–æ–≤. 
–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –æ–ø–ª–∞—Ç–∞ 15.000 —Å—É–º –∑–∞ 
3000 —Ç–æ–∫–µ–Ω–æ–≤.
–¢–∞–∫ –∂–µ –∏–º–µ–µ—Ç—Å—è —É—Å–ª—É–≥–∞ ¬´–±–µ–∑–ª–∏–º–∏—Ç¬ª –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è.
–ó–∞ –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç—è–º–∏ @galactusadmin

–ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã, –Ω–∞–ø–∏—à–∏—Ç–µ –≤ —á–∞—Ç /paid –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.
"""
ADMIN_HELP_MESSAGE = f"""Commands:
‚ö™ /balance ‚Äì Show balance
‚ö™ /help ‚Äì Show help
‚ö™ /paid - Send notifecation for admin to process transaction
‚ö™ /recharge USERID N_TOKENS - Add tokens for user with USERID
"""

def no_tokens_message(): 
   return f"""<b>–£ –≤–∞—Å –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å –¢–û–ö–ï–ù–´‚Ä¶üò¢</b>
–ù–µ —Ä–∞—Å—Å—Ç—Ä–∞–∏–≤–∞–π—Ç–µ—Å—å, –≤—ã –º–æ–∂–µ—Ç–µ –æ–±—Ä–µ—Å—Ç–∏ —Ç–æ–∫–µ–Ω—ã –∑–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é —Å—É–º–º—É –¥–µ–Ω–µ–≥!
–ö–∞–∂–¥—ã–µ 3000 —Ç–æ–∫–µ–Ω–æ–≤ = 15.000 —Å—É–º!!!

PRICE LIST
ü™¨3000 –¢–û–ö–ï–ù–û–í(~700—Å–ª–æ–≤, 3~4 –∑–∞–ø—Ä–æ—Å–∞) 15.000 —Å—É–º
ü™¨6000 –¢–û–ö–ï–ù–û–í(~1400—Å–ª–æ–≤, 6~7 –∑–∞–ø—Ä–æ—Å–æ–≤) 30.000 —Å—É–º
ü™¨10000 –¢–û–ö–ï–ù–û–í(~2400—Å–ª–æ–≤, 10~11 –∑–∞–ø—Ä–æ—Å–æ–≤) 50.000 —Å—É–º
 –ò —Ç–¥.

–ß–µ–º –±–æ–ª—å—à–µ —Ç–æ–∫–µ–Ω–æ–≤ –∑–∞–∫—É–ø–∞–µ—Ç–µ, —Ç–µ–º –±–æ–ª—å—à–µ –±–æ—Ç –≤—ã–¥–∞–µ—Ç –æ—Ç–≤–µ—Ç–æ–≤. 
–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –æ–ø–ª–∞—Ç–∞ 15.000 —Å—É–º –∑–∞ 
3000 —Ç–æ–∫–µ–Ω–æ–≤.
–¢–∞–∫ –∂–µ –∏–º–µ–µ—Ç—Å—è —É—Å–ª—É–≥–∞ ¬´–±–µ–∑–ª–∏–º–∏—Ç¬ª –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è.
–ó–∞ –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç—è–º–∏ @galactusadmin

<b>‚ùóÔ∏è–ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã, –Ω–∞–ø–∏—à–∏—Ç–µ –≤ —á–∞—Ç /paid –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.</b>"""


def you_got_tokens(amount, current_balance):
    message = f"–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!!\n–í—ã —Ç–æ–ª—å–∫–æ —á—Ç–æ –ø—Ä–∏–æ–±—Ä–µ–ª–∏ —Ç–æ–∫–µ–Ω—ã!ü•≥\n"
    message += f"–í—ã –ø–æ–ª—É—á–∏–ª–∏ <b>{amount}</b> —Ç–æ–∫–µ–Ω–æ–≤\n"
    message += f"–í–∞—à –±–∞–ª–∞–Ω—Å: <b>{current_balance}</b>"
    return message


def balance_message(total_n_used_tokens,n_current_tokens):
    text = f"–í—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ <b>{total_n_used_tokens}</b> —Ç–æ–∫–µ–Ω–æ–≤\n\n"
    text +=f"–í–∞—à –±–∞–ª–∞–Ω—Å –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç <b>{str(n_current_tokens)}</b> —Ç–æ–∫–µ–Ω–æ–≤\n"
    return text
def invalid_parameters():
    return f"Invalid parameters"

def toke_amount_invalid(amountStr):
    return f"The number of token is invalid {amountStr}"

def user_not_exists(user_id):
    return f"user {user_id} does not exist or invalid"

def user_paid(username):
    return f"The user {username} has paid!"


def get_start_message(isAdmin,update):
    reply_text = ''
    if not isAdmin:
        reply_text += f'''
Hi! I'm GALACTUS BOT ü§ñ

–° –ø–æ–º–æ—â—å—é —ç—Ç–æ–≥–æ –±–æ—Ç–∞ –≤—ã —Å–º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –æ—Ç –ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞.
–Ø –º–æ–≥—É:

üíª –î–∞—Ç—å —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π –æ—Ç–≤–µ—Ç, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –º–æ–∂–µ—Ç –¥–∞—Ç—å –≤–∞–º Google.

üìù –Ø –º–æ–≥—É –Ω–∞–ø–∏—Å–∞—Ç—å –¥–ª—è –≤–∞—Å Essay(—Å–æ—á–∏–Ω–µ–Ω–∏–µ) –Ω–∞ –ª—é–±—É—é —Ç–µ–º—É.

üìö –ù–∞–ø–∏—Å–∞—Ç—å Assignment, –†–µ—Ñ–µ—Ä–∞—Ç, –î–æ–∫–ª–∞–¥–Ω—É—é —Ä–∞–±–æ—Ç—É –Ω–∞ 3000 —Å–ª–æ–≤ –∏ –±–æ–ª—å—à–µ (–±–µ–∑ –ø–ª–∞–≥–∏–∞—Ç–∞).

üßÆ –†–µ—à–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è.

üí∏ –ù–∞–ø–∏—Å–∞—Ç—å –±–∏–∑–Ω–µ—Å –ø–ª–∞–Ω
–ò –ø–æ–º–æ—á—å —Å —Ä–∞–±–æ—Ç–æ–π.

–Ø –ø–æ–Ω–∏–º–∞—é –±–æ–ª–µ–µ 10 —è–∑—ã–∫–æ–≤, —Ç–∞–∫ –∂–µ –≤—ã –º–æ–∂–µ—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –º–Ω–µ –∞—É–¥–∏–æ –≤–º–µ—Å—Ç–æ —Ç–µ–∫—Å—Ç–∞.

Commands:
ü™¨/balance ‚Äì –ü–æ–∫–∞–∑–∞—Ç—å –ë–∞–ª–∞–Ω—Å
ü™¨/start ‚Äì –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞
ü™¨/help ‚Äì –ü–æ–º–æ—â—å

üé§ –í—ã —Ç–∞–∫ –∂–µ –º–æ–∂–µ—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ì–æ–ª–æ—Å–æ–≤–æ–µ –≤–º–µ—Å—Ç–æ —Ç–µ–∫—Å—Ç–∞.

–ù–û–í–´–ô –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ ?
‚ùóÔ∏è–ú—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–µ–±–µ –±–µ—Å–ø–ª–∞—Ç–Ω–æ {n_default_tokens} –¢–û–ö–ï–ù–û–í!!!
–ü—Ä–æ—Å—Ç–æ –∑–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å:üë©‚Äçüíª
'''
    else:
        reply_text += ADMIN_HELP_MESSAGE
   # reply_text += f"\nNEW USER?\nüî¥Currently you have FREE {n_default_tokens} tokens"

    #reply_text += "\nAnd now... ask me anything!"
    #reply_text += f"\nYour ID is {update.message.from_user.id}"
    return reply_text
def please_wait():
    return "‚è≥ –ü–æ–∂–∞–ª—É–π—Å—Ç–∞ <b>–ø–æ–¥–æ–∂–¥–∏—Ç–µ</b> –ø–æ–∫–∞  –±–æ—Ç –æ—Ç–≤–µ—Ç–∏—Ç –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.\n"




# chat_modes
with open(config_dir / "chat_modes.yml", 'r') as f:
    chat_modes = yaml.safe_load(f)

# models
with open(config_dir / "models.yml", 'r') as f:
    models = yaml.safe_load(f)
